<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tomasz NiedÅºwiecki | InwestujÄ™ w ambitnych</title>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=AW-17886093904"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'AW-17886093904');
    </script>

    <!-- Meta Pixel Code -->
    <script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '1571065357430677');
    fbq('track', 'PageView');
    </script>
    <noscript><img height="1" width="1" style="display:none"
    src="https://www.facebook.com/tr?id=1571065357430677&ev=PageView&noscript=1"
    /></noscript>
    <!-- End Meta Pixel Code -->

    <!-- TikTok Pixel Code -->
    <script>
    !function (w, d, t) {
      w.TiktokAnalyticsObject=t;var ttq=w[t]=w[t]||[];ttq.methods=["page","track","identify","instances","debug","on","off","once","ready","alias","group","enableCookie","disableCookie","holdConsent","revokeConsent","grantConsent"],ttq.setAndDefer=function(t,e){t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}};for(var i=0;i<ttq.methods.length;i++)ttq.setAndDefer(ttq,ttq.methods[i]);ttq.instance=function(t){for(
      var e=ttq._i[t]||[],n=0;n<ttq.methods.length;n++)ttq.setAndDefer(e,ttq.methods[n]);return e},ttq.load=function(e,n){var r="https://analytics.tiktok.com/i18n/pixel/events.js",o=n&&n.partner;ttq._i=ttq._i||{},ttq._i[e]=[],ttq._i[e]._u=r,ttq._t=ttq._t||{},ttq._t[e]=+new Date,ttq._o=ttq._o||{},ttq._o[e]=n||{};n=document.createElement("script")
      ;n.type="text/javascript",n.async=!0,n.src=r+"?sdkid="+e+"&lib="+t;e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(n,e)};
      ttq.load('D5MHQD3C77UALNU7I240');
      ttq.page();
    }(window, document, 'ttq');
    </script>
    <!-- End TikTok Pixel Code -->

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #09090b; }

        .avatar-glow {
            box-shadow: 0 0 20px rgba(168, 85, 247, 0.4), 0 0 40px rgba(168, 85, 247, 0.2);
        }

        .gradient-border {
            padding: 2px;
            border-radius: 1rem;
            background: linear-gradient(90deg, #9333ea, #ec4899, #f97316, #ec4899, #9333ea);
            background-size: 200% 100%;
            animation: flow-wave 4s ease-in-out infinite;
        }
        .gradient-border-inner {
            background: #18181b;
            border-radius: calc(1rem - 2px);
        }
        @keyframes flow-wave {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        input:-webkit-autofill,
        input:-webkit-autofill:hover,
        input:-webkit-autofill:focus,
        textarea:-webkit-autofill {
            -webkit-text-fill-color: white;
            -webkit-box-shadow: 0 0 0px 1000px #27272a inset;
        }

        .step { display: none; }
        .step.active { display: flex; }

        .fade-in {
            animation: fadeIn 0.4s ease-out forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .chat-bubble {
            opacity: 0;
            transform: translateY(10px);
            animation: bubbleIn 0.3s ease-out forwards;
        }
        @keyframes bubbleIn {
            to { opacity: 1; transform: translateY(0); }
        }
        .chat-bubble:nth-child(1) { animation-delay: 0.1s; }
        .chat-bubble:nth-child(2) { animation-delay: 0.3s; }
        .chat-bubble:nth-child(3) { animation-delay: 0.5s; }
        .chat-bubble:nth-child(4) { animation-delay: 0.7s; }
        .chat-cta { opacity: 0; animation: bubbleIn 0.3s ease-out 0.9s forwards; }

        .option-btn {
            transition: all 0.2s;
        }
        .option-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        .option-btn.selected {
            border-color: rgba(168, 85, 247, 0.5);
            background: rgba(168, 85, 247, 0.1);
        }

        .success-icon {
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }
        @keyframes popIn {
            0% { transform: scale(0); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        .success-checkmark {
            stroke-dasharray: 30;
            stroke-dashoffset: 30;
            animation: drawCheck 0.4s ease-out 0.3s forwards;
        }
        @keyframes drawCheck {
            to { stroke-dashoffset: 0; }
        }

        textarea::-webkit-scrollbar { width: 6px; }
        textarea::-webkit-scrollbar-track { background: #27272a; border-radius: 3px; }
        textarea::-webkit-scrollbar-thumb { background: #52525b; border-radius: 3px; }

        .gradient-underline {
            position: relative;
            display: inline-block;
        }
        .gradient-underline::after {
            content: '';
            position: absolute;
            left: 0;
            right: 0;
            bottom: -2px;
            height: 2px;
            background: linear-gradient(90deg, #9333ea, #ec4899, #f97316, #ec4899, #9333ea);
            background-size: 200% 100%;
            border-radius: 2px;
            animation: underline-wave 4s ease-in-out infinite;
            box-shadow: 0 0 8px rgba(236, 72, 153, 0.5), 0 0 16px rgba(236, 72, 153, 0.3);
        }
        @keyframes underline-wave {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
    </style>
</head>
<body class="text-white min-h-screen">

    <!-- Progress Bar -->
    <div id="progress-bar" class="fixed top-0 left-0 right-0 h-1 bg-zinc-900 z-50 hidden">
        <div id="progress-fill" class="h-full bg-gradient-to-r from-purple-600 via-pink-500 to-orange-400 transition-all duration-500" style="width: 0%"></div>
    </div>

    <!-- STEP 0: Email -->
    <main id="step-0" class="step active min-h-screen flex-col items-center justify-center px-4 py-8">
        <div class="w-full max-w-md fade-in">
            <div class="text-center mb-6">
                <div class="relative inline-block">
                    <img src="https://www.tomekniedzwiecki.pl/photos/old_tomek_cale.jpg" alt="Tomasz" class="w-16 h-16 rounded-full object-cover object-top avatar-glow">
                    <div class="absolute bottom-0 right-0 w-4 h-4 bg-green-500 rounded-full border-2 border-zinc-950"></div>
                </div>
                <div class="text-white font-semibold mt-2">Tomasz NiedÅºwiecki</div>
                <div class="text-zinc-500 text-xs">TwÃ³rca TakeDrop</div>
            </div>

            <div class="space-y-2 mb-6">
                <div class="flex justify-start chat-bubble">
                    <div class="bg-zinc-800 rounded-2xl rounded-bl-sm px-4 py-2.5 max-w-[85%]">
                        <p class="text-[15px]">Hej! ðŸ‘‹ ZbudowaÅ‚em firmÄ™ wycenionÄ… na <span class="font-semibold">25 mln zÅ‚</span> i sprzedaÅ‚em udziaÅ‚y.</p>
                    </div>
                </div>
                <div class="flex justify-start chat-bubble">
                    <div class="bg-zinc-800 rounded-2xl rounded-bl-sm px-4 py-2.5 max-w-[85%]">
                        <p class="text-[15px]">Teraz zainwestujÄ™ w parÄ™ osÃ³b, ktÃ³rym zbudujÄ™ biznes online.</p>
                    </div>
                </div>
                <div class="flex justify-end chat-bubble">
                    <div class="bg-gradient-to-r from-purple-600 via-pink-500 to-orange-400 rounded-2xl rounded-br-sm px-4 py-2.5">
                        <p class="text-[15px]">Jak siÄ™ zgÅ‚osiÄ‡?</p>
                    </div>
                </div>
                <div class="flex justify-start chat-bubble">
                    <div class="bg-zinc-800 rounded-2xl rounded-bl-sm px-4 py-2.5 max-w-[85%]">
                        <p class="text-[15px]">Odpowiedz na parÄ™ pytaÅ„ ðŸ‘‡</p>
                    </div>
                </div>
            </div>

            <div class="gradient-border chat-cta">
                <form id="email-form" class="gradient-border-inner p-1.5 flex items-center gap-1.5">
                    <input type="email" id="email-input" placeholder="TwÃ³j e-mail" class="flex-1 px-4 py-3 bg-transparent text-white placeholder-zinc-500 text-[15px] focus:outline-none min-w-0" required>
                    <button type="submit" class="px-5 py-2.5 bg-white text-zinc-900 rounded-xl font-semibold text-[15px] hover:bg-zinc-100 transition-colors flex-shrink-0">
                        Start
                    </button>
                </form>
            </div>
            <p class="text-zinc-600 text-[11px] text-center mt-3 chat-cta">
                WysyÅ‚ajÄ…c akceptujesz <a href="#" class="underline hover:text-zinc-400">regulamin</a>
            </p>
        </div>
    </main>

    <!-- STEP 1: Direction -->
    <main id="step-1" class="step min-h-screen flex-col items-center justify-center px-4 py-8">
        <div class="w-full max-w-lg fade-in">
            <div class="text-center mb-8">
                <img src="https://www.tomekniedzwiecki.pl/photos/old_tomek_cale.jpg" alt="Tomasz" class="w-12 h-12 rounded-full object-cover object-top mx-auto avatar-glow">
            </div>

            <p class="text-white font-medium text-lg mb-2">KtÃ³ry kierunek CiÄ™ bardziej interesuje?</p>
            <p class="text-zinc-500 text-sm mb-5">Oba sÄ… dobre. Wybierz ten, ktÃ³ry pasuje do Ciebie.</p>

            <div class="space-y-3" id="q1-options">
                <button type="button" data-value="sklep" class="option-btn w-full text-left px-5 py-4 bg-zinc-900 border border-zinc-800 rounded-xl text-[15px] hover:border-zinc-600">
                    ðŸ›’ Sklep internetowy
                </button>
                <button type="button" data-value="aplikacja" class="option-btn w-full text-left px-5 py-4 bg-zinc-900 border border-zinc-800 rounded-xl text-[15px] hover:border-zinc-600">
                    ðŸ“± Aplikacja / SaaS
                </button>
            </div>
        </div>
    </main>

    <!-- STEP 2: Weekly Hours -->
    <main id="step-2" class="step min-h-screen flex-col items-center justify-center px-4 py-8">
        <div class="w-full max-w-lg fade-in">
            <div class="text-center mb-6">
                <img src="https://www.tomekniedzwiecki.pl/photos/old_tomek_cale.jpg" alt="Tomasz" class="w-12 h-12 rounded-full object-cover object-top mx-auto avatar-glow">
            </div>

            <p class="text-white font-medium text-lg mb-2">Ile czasu <span class="gradient-underline">tygodniowo</span> moÅ¼esz poÅ›wiÄ™ciÄ‡ na spotkania?</p>
            <p class="text-zinc-500 text-sm mb-5">Na poczÄ…tek bÄ™dÄ™ przekazywaÅ‚ Ci wiedzÄ™ i umiejÄ™tnoÅ›ci.</p>

            <div class="space-y-3" id="q2-options">
                <button type="button" data-value="1-2h" class="option-btn w-full text-left px-5 py-4 bg-zinc-900 border border-zinc-800 rounded-xl text-[15px] hover:border-zinc-600">
                    1-2 godziny
                </button>
                <button type="button" data-value="3-5h" class="option-btn w-full text-left px-5 py-4 bg-zinc-900 border border-zinc-800 rounded-xl text-[15px] hover:border-zinc-600">
                    3-5 godzin
                </button>
                <button type="button" data-value="6-10h" class="option-btn w-full text-left px-5 py-4 bg-zinc-900 border border-zinc-800 rounded-xl text-[15px] hover:border-zinc-600">
                    6-10 godzin
                </button>
                <button type="button" data-value="fulltime" class="option-btn w-full text-left px-5 py-4 bg-zinc-900 border border-zinc-800 rounded-xl text-[15px] hover:border-zinc-600">
                    Full-time
                </button>
            </div>
        </div>
    </main>

    <!-- STEP 3: Target Income -->
    <main id="step-3" class="step min-h-screen flex-col items-center justify-center px-4 py-8">
        <div class="w-full max-w-lg fade-in">
            <div class="text-center mb-8">
                <img src="https://www.tomekniedzwiecki.pl/photos/old_tomek_cale.jpg" alt="Tomasz" class="w-12 h-12 rounded-full object-cover object-top mx-auto avatar-glow">
            </div>

            <p class="text-white font-medium text-lg mb-2">Jaki dochÃ³d chcesz osiÄ…gnÄ…Ä‡ <span class="gradient-underline">po roku</span> wspÃ³Å‚pracy?</p>
            <p class="text-zinc-500 text-sm mb-5">MiesiÄ™cznie, na czysto.</p>

            <div class="space-y-3" id="q3-options">
                <button type="button" data-value="5-10k" class="option-btn w-full text-left px-5 py-4 bg-zinc-900 border border-zinc-800 rounded-xl text-[15px] hover:border-zinc-600">
                    5 000 - 10 000 zÅ‚
                </button>
                <button type="button" data-value="10-20k" class="option-btn w-full text-left px-5 py-4 bg-zinc-900 border border-zinc-800 rounded-xl text-[15px] hover:border-zinc-600">
                    10 000 - 20 000 zÅ‚
                </button>
                <button type="button" data-value="20-50k" class="option-btn w-full text-left px-5 py-4 bg-zinc-900 border border-zinc-800 rounded-xl text-[15px] hover:border-zinc-600">
                    20 000 - 50 000 zÅ‚
                </button>
                <button type="button" data-value="50k+" class="option-btn w-full text-left px-5 py-4 bg-zinc-900 border border-zinc-800 rounded-xl text-[15px] hover:border-zinc-600">
                    Ponad 50 000 zÅ‚
                </button>
            </div>
        </div>
    </main>

    <!-- STEP 4: Experience -->
    <main id="step-4" class="step min-h-screen flex-col items-center justify-center px-4 py-8">
        <div class="w-full max-w-lg fade-in">
            <div class="text-center mb-8">
                <img src="https://www.tomekniedzwiecki.pl/photos/old_tomek_cale.jpg" alt="Tomasz" class="w-12 h-12 rounded-full object-cover object-top mx-auto avatar-glow">
            </div>

            <p class="text-white font-medium text-lg mb-2">Masz doÅ›wiadczenie w biznesach internetowych?</p>
            <p class="text-zinc-500 text-sm mb-5">JeÅ›li tak - jakie i jaka skala. JeÅ›li nie - dlaczego chcesz zaczÄ…Ä‡.</p>

            <textarea id="q4-experience" rows="5" placeholder="Napisz tutaj..." class="w-full bg-zinc-900 border border-zinc-800 text-white rounded-xl px-5 py-4 text-[15px] focus:outline-none focus:border-zinc-600 resize-none placeholder:text-zinc-600 mb-5"></textarea>

            <button type="button" id="q4-next" class="w-full py-4 bg-white text-zinc-900 rounded-xl font-semibold text-[15px] hover:bg-zinc-100 transition-colors disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                Dalej â†’
            </button>
        </div>
    </main>

    <!-- STEP 5: Budget -->
    <main id="step-5" class="step min-h-screen flex-col items-center justify-center px-4 py-8">
        <div class="w-full max-w-lg fade-in">
            <div class="text-center mb-8">
                <img src="https://www.tomekniedzwiecki.pl/photos/old_tomek_cale.jpg" alt="Tomasz" class="w-12 h-12 rounded-full object-cover object-top mx-auto avatar-glow">
            </div>

            <p class="text-white font-medium text-lg mb-2">Jaki budÅ¼et moÅ¼esz zainwestowaÄ‡?</p>
            <p class="text-zinc-500 text-sm mb-5">Na reklamÄ™, towar, narzÄ™dzia.</p>

            <div class="space-y-3" id="q5-options">
                <button type="button" data-value="5-10k" class="option-btn w-full text-left px-5 py-4 bg-zinc-900 border border-zinc-800 rounded-xl text-[15px] hover:border-zinc-600">
                    5 000 - 10 000 zÅ‚
                </button>
                <button type="button" data-value="10-20k" class="option-btn w-full text-left px-5 py-4 bg-zinc-900 border border-zinc-800 rounded-xl text-[15px] hover:border-zinc-600">
                    10 000 - 20 000 zÅ‚
                </button>
                <button type="button" data-value="20-40k" class="option-btn w-full text-left px-5 py-4 bg-zinc-900 border border-zinc-800 rounded-xl text-[15px] hover:border-zinc-600">
                    20 000 - 40 000 zÅ‚
                </button>
                <button type="button" data-value="40k+" class="option-btn w-full text-left px-5 py-4 bg-zinc-900 border border-zinc-800 rounded-xl text-[15px] hover:border-zinc-600">
                    Ponad 40 000 zÅ‚
                </button>
            </div>
        </div>
    </main>

    <!-- STEP 6: Thank You -->
    <main id="step-6" class="step min-h-screen flex-col items-center justify-center px-4 py-8">
        <div class="w-full max-w-md text-center fade-in">
            <div class="mb-6">
                <div class="w-20 h-20 mx-auto bg-gradient-to-r from-purple-600 via-pink-500 to-orange-400 rounded-full flex items-center justify-center success-icon">
                    <svg class="w-10 h-10 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                        <path class="success-checkmark" stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                    </svg>
                </div>
            </div>

            <h1 class="text-2xl font-bold mb-2">DziÄ™ki!</h1>
            <p class="text-zinc-400 mb-8">PrzeanalizujÄ™ Twoje zgÅ‚oszenie i odezwÄ™ siÄ™ <span class="text-white font-medium">w ciÄ…gu kilku dni</span>.</p>

            <div class="bg-zinc-900/60 border border-zinc-800 rounded-xl p-5 text-left">
                <h3 class="text-white font-medium mb-3">Co dalej?</h3>
                <ul class="space-y-2 text-zinc-400 text-sm">
                    <li class="flex items-start gap-2">
                        <span class="text-purple-400">1.</span>
                        <span>PrzeglÄ…dam zgÅ‚oszenia osobiÅ›cie</span>
                    </li>
                    <li class="flex items-start gap-2">
                        <span class="text-pink-400">2.</span>
                        <span>JeÅ›li widzÄ™ potencjaÅ‚ - krÃ³tka rozmowa</span>
                    </li>
                    <li class="flex items-start gap-2">
                        <span class="text-orange-400">3.</span>
                        <span>Wybieram osoby do wspÃ³Å‚pracy</span>
                    </li>
                </ul>
            </div>
        </div>
    </main>

    <script>
        // Supabase
        const SUPABASE_URL = 'https://yxmavwkwnfuphjqbelws.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl4bWF2d2t3bmZ1cGhqcWJlbHdzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg3NjQyNTUsImV4cCI6MjA4NDM0MDI1NX0.XeR0Fc7OFn6YbNJrOKTBEj36JtmLISZTM87y4ai9340';
        const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // State
        let currentStep = 0;
        let leadId = null;
        const STORAGE_KEY = 'tn_zapisy_data';

        // Load saved data
        function loadSavedData() {
            const saved = localStorage.getItem(STORAGE_KEY);
            return saved ? JSON.parse(saved) : {};
        }

        // Save data
        function saveData(key, value) {
            const data = loadSavedData();
            data[key] = value;
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
        }

        // Clear data
        function clearData() {
            localStorage.removeItem(STORAGE_KEY);
        }

        // Update progress bar
        function updateProgress() {
            const progress = document.getElementById('progress-fill');
            const bar = document.getElementById('progress-bar');
            if (currentStep === 0 || currentStep === 6) {
                bar.classList.add('hidden');
            } else {
                bar.classList.remove('hidden');
                progress.style.width = ((currentStep) / 5 * 100) + '%';
            }
        }

        // Go to step
        function goToStep(step) {
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            const targetStep = document.getElementById('step-' + step);
            if (targetStep) {
                targetStep.classList.add('active');
                currentStep = step;
                updateProgress();
                window.scrollTo(0, 0);
            }
        }

        // Restore selections from localStorage
        function restoreSelections() {
            const data = loadSavedData();

            if (data.email) {
                document.getElementById('email-input').value = data.email;
            }

            if (data.direction) {
                const btn = document.querySelector(`#q1-options [data-value="${data.direction}"]`);
                if (btn) btn.classList.add('selected');
            }

            if (data.weekly_hours) {
                const btn = document.querySelector(`#q2-options [data-value="${data.weekly_hours}"]`);
                if (btn) btn.classList.add('selected');
            }

            if (data.target_income) {
                const btn = document.querySelector(`#q3-options [data-value="${data.target_income}"]`);
                if (btn) btn.classList.add('selected');
            }

            if (data.experience) {
                document.getElementById('q4-experience').value = data.experience;
                document.getElementById('q4-next').disabled = false;
            }

            if (data.budget) {
                const btn = document.querySelector(`#q5-options [data-value="${data.budget}"]`);
                if (btn) btn.classList.add('selected');
            }

            // Resume from where user left off
            if (data.lead_id) {
                leadId = data.lead_id;
                if (data.completed) {
                    goToStep(6);
                } else if (data.budget) {
                    goToStep(5);
                } else if (data.experience) {
                    goToStep(4);
                } else if (data.target_income) {
                    goToStep(3);
                } else if (data.weekly_hours) {
                    goToStep(2);
                } else if (data.direction) {
                    goToStep(1);
                } else {
                    goToStep(1);
                }
            }
        }

        // Tracking params
        const TRACKING_PARAMS = ['gclid', 'gbraid', 'wbraid', 'gad_source', 'fbclid', 'ttclid', 'utm_source', 'utm_medium', 'utm_campaign', 'utm_content', 'utm_term', 'utm_id'];

        function captureTrackingParams() {
            const urlParams = new URLSearchParams(window.location.search);
            const stored = JSON.parse(sessionStorage.getItem('tracking_params') || '{}');
            TRACKING_PARAMS.forEach(param => {
                const value = urlParams.get(param);
                if (value) stored[param] = value;
            });
            if (!stored.landing_page) stored.landing_page = window.location.href;
            if (!stored.referrer && document.referrer) stored.referrer = document.referrer;
            sessionStorage.setItem('tracking_params', JSON.stringify(stored));
            return stored;
        }

        function getTrackingData() {
            const stored = JSON.parse(sessionStorage.getItem('tracking_params') || '{}');
            stored.user_agent = navigator.userAgent;
            return stored;
        }

        captureTrackingParams();

        // Update lead in database
        async function updateLead(updates) {
            if (!leadId) return;
            try {
                await supabaseClient.from('leads').update(updates).eq('id', leadId);
            } catch (err) {
                console.error('Error updating lead:', err);
            }
        }

        // STEP 0: Email form
        document.getElementById('email-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            const email = document.getElementById('email-input').value;
            saveData('email', email);

            try {
                const { data: leadResult, error: leadError } = await supabaseClient
                    .from('leads')
                    .insert([{ email: email }])
                    .select('id')
                    .single();

                if (!leadError && leadResult) {
                    leadId = leadResult.id;
                    saveData('lead_id', leadId);

                    const trackingData = getTrackingData();
                    await supabaseClient.from('lead_tracking').insert([{ lead_id: leadId, ...trackingData }]);
                }
            } catch (err) {
                console.error('Error:', err);
            }

            gtag('event', 'conversion', {'send_to': 'AW-17886093904/8_ykCOCF9OcbENDE4NBC'});
            fbq('track', 'Lead');
            ttq.track('SubmitForm');

            goToStep(1);
        });

        // STEP 1: Direction
        document.querySelectorAll('#q1-options .option-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('#q1-options .option-btn').forEach(b => b.classList.remove('selected'));
                this.classList.add('selected');
                const value = this.dataset.value;
                saveData('direction', value);
                updateLead({ direction: value });
                setTimeout(() => goToStep(2), 300);
            });
        });

        // STEP 2: Weekly hours
        document.querySelectorAll('#q2-options .option-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('#q2-options .option-btn').forEach(b => b.classList.remove('selected'));
                this.classList.add('selected');
                const value = this.dataset.value;
                saveData('weekly_hours', value);
                updateLead({ weekly_hours: value });
                setTimeout(() => goToStep(3), 300);
            });
        });

        // STEP 3: Target income
        document.querySelectorAll('#q3-options .option-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('#q3-options .option-btn').forEach(b => b.classList.remove('selected'));
                this.classList.add('selected');
                const value = this.dataset.value;
                saveData('target_income', value);
                updateLead({ target_income: value });
                setTimeout(() => goToStep(4), 300);
            });
        });

        // STEP 4: Experience
        const expTextarea = document.getElementById('q4-experience');
        const expNextBtn = document.getElementById('q4-next');

        expTextarea.addEventListener('input', function() {
            expNextBtn.disabled = this.value.trim().length < 10;
        });

        expNextBtn.addEventListener('click', function() {
            const value = expTextarea.value.trim();
            saveData('experience', value);
            updateLead({ experience: value });
            goToStep(5);
        });

        // STEP 5: Budget
        document.querySelectorAll('#q5-options .option-btn').forEach(btn => {
            btn.addEventListener('click', async function() {
                document.querySelectorAll('#q5-options .option-btn').forEach(b => b.classList.remove('selected'));
                this.classList.add('selected');
                const value = this.dataset.value;
                saveData('budget', value);
                saveData('completed', true);
                await updateLead({ budget: value });

                gtag('event', 'form_complete', {'event_category': 'engagement'});
                fbq('track', 'CompleteRegistration');
                ttq.track('CompleteRegistration');

                setTimeout(() => {
                    clearData(); // Clear after completion
                    goToStep(6);
                }, 300);
            });
        });

        // Initialize
        restoreSelections();
    </script>

</body>
</html>
