<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tomasz Niedźwiecki</title>
    <meta name="description" content="Inwestuję w ludzi i buduję z nimi biznesy.">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
        }
    }
    </script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background: #000;
            color: #ededed;
        }

        ::selection {
            background: #fff;
            color: #000;
        }

        /* ==================== FULLPAGE SCROLL ==================== */
        .fullpage-container {
            height: 100vh;
            overflow-y: auto;
            scroll-snap-type: y mandatory;
            scroll-behavior: smooth;
        }
        .fullpage-container.is-scrolling {
            scroll-snap-type: none;
        }
        .fullpage-section {
            height: 100vh;
            scroll-snap-align: start;
            scroll-snap-stop: always;
            position: relative;
        }

        /* Tetris panel - DESKTOP ONLY */
        #tetris-panel {
            display: none;
        }
        @media (min-width: 768px) {
            #tetris-panel {
                display: block;
                position: fixed;
                top: 0;
                right: 0;
                width: 55%;
                height: 100vh;
                z-index: 1;
            }
            #tetris-canvas {
                width: 100%;
                height: 100%;
            }
            .tetris-overlay {
                position: absolute;
                inset: 0;
                background:
                    linear-gradient(to right,
                        rgba(0,0,0,1) 0%,
                        rgba(0,0,0,0.85) 10%,
                        rgba(0,0,0,0.4) 25%,
                        rgba(0,0,0,0.1) 45%,
                        transparent 60%),
                    radial-gradient(ellipse at 70% 50%,
                        transparent 40%,
                        rgba(0,0,0,0.3) 100%);
                pointer-events: none;
            }
        }
        @media (min-width: 1600px) {
            #tetris-panel {
                width: 58%;
            }
        }

        /* Content area */
        .content-area {
            position: relative;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            padding: 0 1.5rem;
        }
        .content-area > .section-content {
            width: 100%;
            max-width: 420px;
        }

        /* Desktop: LEFT side only */
        @media (min-width: 768px) {
            .content-area {
                width: 45% !important;
                max-width: 45% !important;
                padding: 0 3rem;
            }
            .content-area > .section-content {
                max-width: 500px;
            }
        }
        @media (min-width: 1200px) {
            .content-area {
                padding: 0 4rem;
            }
            .content-area > .section-content {
                max-width: 540px;
            }
        }
        @media (min-width: 1600px) {
            .content-area {
                width: 42% !important;
                max-width: 42% !important;
                padding: 0 5rem;
            }
            .content-area > .section-content {
                max-width: 580px;
            }
        }

        /* Dots navigation - at the edge between content and tetris */
        .dots-nav {
            position: fixed;
            left: 45%;
            top: 50%;
            transform: translateY(-50%);
            z-index: 40;
            display: flex;
            flex-direction: column;
            gap: 18px;
        }
        @media (min-width: 1600px) {
            .dots-nav {
                left: 42%;
            }
        }
        @media (max-width: 767px) {
            .dots-nav { display: none; }
        }
        .dots-nav button {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: rgba(255,255,255,0.25);
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        .dots-nav button:hover {
            background: rgba(255,255,255,0.4);
        }
        .dots-nav button.active {
            background: #fff;
        }
        .dots-nav button::after {
            content: attr(data-label);
            position: absolute;
            right: 24px;
            top: 50%;
            transform: translateY(-50%);
            white-space: nowrap;
            font-size: 11px;
            color: rgba(255,255,255,0.5);
            opacity: 0;
            transition: opacity 0.2s ease;
            pointer-events: none;
        }
        .dots-nav button:hover::after {
            opacity: 1;
        }

        /* Section content animation */
        .section-content {
            opacity: 0;
            transform: translateY(40px);
            transition: all 0.8s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .section-content.visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* ==================== EXISTING STYLES ==================== */
        .card {
            position: relative;
            background: rgba(10,10,10,0.8);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 16px;
        }
        .card::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 16px;
            padding: 1px;
            background: linear-gradient(to bottom, rgba(255,255,255,0.1), rgba(255,255,255,0.02));
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            pointer-events: none;
        }

        .glow {
            box-shadow:
                0 0 0 1px rgba(255,255,255,0.03),
                0 8px 40px -12px rgba(0,0,0,0.8),
                0 0 80px -40px rgba(99,102,241,0.3);
        }

        .noise::after {
            content: '';
            position: absolute;
            inset: 0;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
            opacity: 0.02;
            pointer-events: none;
            border-radius: inherit;
        }

        .gradient-text {
            background: linear-gradient(to bottom, #fff 20%, #71717a);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .btn-primary {
            background: linear-gradient(to bottom, #fff, #d4d4d8);
            box-shadow:
                0 1px 2px rgba(0,0,0,0.1),
                inset 0 1px 0 rgba(255,255,255,0.5),
                0 0 0 1px rgba(0,0,0,0.1);
        }
        .btn-primary:hover {
            background: linear-gradient(to bottom, #f4f4f5, #d4d4d8);
        }

        .stat-number {
            font-variant-numeric: tabular-nums;
            letter-spacing: -0.03em;
        }

        .divider {
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
        }

        /* Track record section styles */
        .track-section {
            position: relative;
        }
        .track-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 50%;
            bottom: 0;
            background: radial-gradient(ellipse at 30% 50%, var(--accent-glow, rgba(99,102,241,0.08)) 0%, transparent 70%);
            pointer-events: none;
        }
        .track-icon {
            width: 100px;
            height: 100px;
            border-radius: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 2.5rem;
        }

        /* ==================== OFFER CARDS ==================== */
        .offer-cards {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .offer-card {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px 20px;
            background: rgba(255,255,255,0.02);
            border: 1px solid rgba(255,255,255,0.06);
            border-radius: 16px;
            transition: all 0.3s ease;
        }
        .offer-card:hover {
            background: rgba(255,255,255,0.04);
            border-color: rgba(255,255,255,0.1);
            transform: translateX(4px);
        }
        .offer-card__icon {
            width: 52px;
            height: 52px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            position: relative;
        }
        .offer-card__icon i {
            font-size: 26px;
            position: relative;
            z-index: 1;
        }
        .offer-card__icon::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 14px;
            opacity: 0.15;
        }
        .offer-card__icon::after {
            content: '';
            position: absolute;
            inset: -16px;
            border-radius: 24px;
            opacity: 0.6;
            transition: opacity 0.3s ease;
        }
        .offer-card:hover .offer-card__icon::after {
            opacity: 1;
        }
        .offer-card__icon {
            transition: box-shadow 0.3s ease;
        }
        .offer-card__content h3 {
            font-size: 17px;
            font-weight: 600;
            color: #fff;
            margin-bottom: 4px;
        }
        .offer-card__content p {
            font-size: 14px;
            color: #71717a;
            line-height: 1.5;
        }
        /* Emerald variant */
        .offer-card--emerald .offer-card__icon {
            background: rgba(16, 185, 129, 0.15);
            border: 1px solid rgba(16, 185, 129, 0.3);
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.2);
        }
        .offer-card--emerald .offer-card__icon i {
            color: #34d399;
        }
        .offer-card--emerald .offer-card__icon::after {
            background: radial-gradient(circle, rgba(16, 185, 129, 0.4) 0%, rgba(16, 185, 129, 0.15) 40%, transparent 70%);
        }
        .offer-card--emerald:hover {
            border-color: rgba(16, 185, 129, 0.25);
        }
        .offer-card--emerald:hover .offer-card__icon {
            box-shadow: 0 0 35px rgba(16, 185, 129, 0.35), 0 0 70px rgba(16, 185, 129, 0.15);
        }
        /* Amber variant */
        .offer-card--amber .offer-card__icon {
            background: rgba(255, 180, 0, 0.15);
            border: 1px solid rgba(255, 180, 0, 0.3);
            box-shadow: 0 0 20px rgba(255, 180, 0, 0.2);
        }
        .offer-card--amber .offer-card__icon i {
            color: #ffb400;
        }
        .offer-card--amber .offer-card__icon::after {
            background: radial-gradient(circle, rgba(255, 180, 0, 0.4) 0%, rgba(255, 180, 0, 0.15) 40%, transparent 70%);
        }
        .offer-card--amber:hover {
            border-color: rgba(255, 180, 0, 0.25);
        }
        .offer-card--amber:hover .offer-card__icon {
            box-shadow: 0 0 35px rgba(255, 180, 0, 0.35), 0 0 70px rgba(255, 180, 0, 0.15);
        }
        /* Purple variant */
        .offer-card--purple .offer-card__icon {
            background: rgba(168, 85, 247, 0.15);
            border: 1px solid rgba(168, 85, 247, 0.3);
            box-shadow: 0 0 20px rgba(168, 85, 247, 0.2);
        }
        .offer-card--purple .offer-card__icon i {
            color: #c084fc;
        }
        .offer-card--purple .offer-card__icon::after {
            background: radial-gradient(circle, rgba(168, 85, 247, 0.4) 0%, rgba(168, 85, 247, 0.15) 40%, transparent 70%);
        }
        .offer-card--purple:hover {
            border-color: rgba(168, 85, 247, 0.25);
        }
        .offer-card--purple:hover .offer-card__icon {
            box-shadow: 0 0 35px rgba(168, 85, 247, 0.35), 0 0 70px rgba(168, 85, 247, 0.15);
        }

        /* ==================== MOBILE STYLES ==================== */
        @media (max-width: 767px) {
            /* Section content always visible on mobile */
            .section-content {
                opacity: 1;
                transform: none;
            }

            /* Hero adjustments */
            .fullpage-section[data-section="0"] h1 {
                font-size: 32px;
                line-height: 1.2;
            }
            .fullpage-section[data-section="0"] .btn-primary {
                width: 100%;
                justify-content: center;
            }

            /* Track icon smaller on mobile */
            .track-icon {
                width: 72px;
                height: 72px;
                border-radius: 20px;
                margin-bottom: 1.5rem;
            }
            .track-icon i {
                font-size: 32px !important;
            }

            /* Track record headings */
            .fullpage-section h2 {
                font-size: 32px !important;
            }

            /* Subtitle (colored text under heading) */
            .fullpage-section p[class*="text-emerald-400"],
            .fullpage-section p[class*="text-[#ffb400]"],
            .fullpage-section p[class*="text-purple-400"] {
                font-size: 22px !important;
                margin-bottom: 1.5rem !important;
            }

            /* Stats/tags row - wrap and center */
            .fullpage-section .flex.items-center.gap-8,
            .fullpage-section .flex.items-center.gap-6 {
                flex-wrap: wrap;
                gap: 12px !important;
            }

            /* Tags row (Sklep, TakeDrop, Inkubator) */
            .fullpage-section .flex.items-center.gap-4 {
                flex-wrap: wrap;
                gap: 8px !important;
            }

            /* Paragraph text on mobile */
            .fullpage-section p.text-zinc-400 {
                font-size: 15px !important;
                line-height: 1.7;
            }

            /* Motto quote smaller */
            .fullpage-section blockquote {
                font-size: 20px !important;
                line-height: 1.5;
            }

            /* Droga section intro - text adjustments */
            .fullpage-section[data-section="1"] h2 {
                font-size: 28px !important;
            }

            /* Współpraca heading */
            .fullpage-section[data-section="6"] h2 {
                font-size: 26px !important;
            }

            /* Offer cards on mobile */
            .offer-cards {
                gap: 10px;
            }
            .offer-card {
                padding: 14px 16px;
                gap: 14px;
                background: rgba(255,255,255,0.03);
            }
            .offer-card__icon {
                width: 44px;
                height: 44px;
                border-radius: 12px;
            }
            .offer-card__icon i {
                font-size: 22px;
            }
            /* Glow always visible on mobile - INTENSYWNY */
            .offer-card__icon::after {
                opacity: 1;
                inset: -24px;
            }
            .offer-card--emerald .offer-card__icon {
                background: rgba(16, 185, 129, 0.2);
                border-color: rgba(16, 185, 129, 0.4);
                box-shadow: 0 0 30px rgba(16, 185, 129, 0.3), 0 0 60px rgba(16, 185, 129, 0.15);
            }
            .offer-card--emerald .offer-card__icon::after {
                background: radial-gradient(circle, rgba(16, 185, 129, 0.5) 0%, rgba(16, 185, 129, 0.2) 40%, transparent 70%);
            }
            .offer-card--amber .offer-card__icon {
                background: rgba(255, 180, 0, 0.2);
                border-color: rgba(255, 180, 0, 0.4);
                box-shadow: 0 0 30px rgba(255, 180, 0, 0.3), 0 0 60px rgba(255, 180, 0, 0.15);
            }
            .offer-card--amber .offer-card__icon::after {
                background: radial-gradient(circle, rgba(255, 180, 0, 0.5) 0%, rgba(255, 180, 0, 0.2) 40%, transparent 70%);
            }
            .offer-card--purple .offer-card__icon {
                background: rgba(168, 85, 247, 0.2);
                border-color: rgba(168, 85, 247, 0.4);
                box-shadow: 0 0 30px rgba(168, 85, 247, 0.3), 0 0 60px rgba(168, 85, 247, 0.15);
            }
            .offer-card--purple .offer-card__icon::after {
                background: radial-gradient(circle, rgba(168, 85, 247, 0.5) 0%, rgba(168, 85, 247, 0.2) 40%, transparent 70%);
            }
            .offer-card__content h3 {
                font-size: 15px;
                margin-bottom: 2px;
            }
            .offer-card__content p {
                font-size: 13px;
            }

            /* CTA section */
            .fullpage-section[data-section="7"] h2 {
                font-size: 32px !important;
            }
            .fullpage-section[data-section="7"] .btn-primary {
                width: 100%;
                justify-content: center;
            }

            /* Footer on mobile */
            .fullpage-section[data-section="7"] .border-t {
                padding-top: 1.5rem;
            }

            /* Track section glow on mobile - full width, centered */
            .track-section::before {
                right: 0;
                background: radial-gradient(ellipse at 50% 40%, var(--accent-glow, rgba(99,102,241,0.15)) 0%, transparent 70%);
            }

            /* Badge in hero - compact on mobile */
            .fullpage-section[data-section="0"] .inline-flex {
                padding: 8px 14px;
                margin-bottom: 1.5rem;
            }
            .fullpage-section[data-section="0"] .inline-flex .text-\[14px\] {
                font-size: 11px;
            }
            .fullpage-section[data-section="0"] .inline-flex .text-white {
                font-size: 12px;
            }
        }

        /* Mobile scroll indicator */
        .scroll-indicator {
            display: none;
        }
        @media (max-width: 767px) {
            .scroll-indicator {
                display: flex;
                position: absolute;
                bottom: 40px;
                left: 50%;
                transform: translateX(-50%);
                flex-direction: column;
                align-items: center;
                gap: 6px;
                color: rgba(255,255,255,0.5);
                font-size: 10px;
                font-weight: 500;
                letter-spacing: 0.15em;
                z-index: 20;
                animation: bounce 2s ease-in-out infinite;
            }
            .scroll-indicator svg {
                width: 18px;
                height: 18px;
            }
            @keyframes bounce {
                0%, 100% { transform: translateX(-50%) translateY(0); }
                50% { transform: translateX(-50%) translateY(6px); }
            }
        }

        /* Keyboard controls - redesigned */
        #keyboard-controls {
            display: none;
        }
        @media (min-width: 768px) {
            #keyboard-controls {
                display: block;
                position: absolute;
                bottom: 40px;
                right: 40px;
                z-index: 10;
                background: rgba(0, 0, 0, 0.5);
                backdrop-filter: blur(16px);
                border: 1px solid rgba(255,255,255,0.08);
                border-radius: 16px;
                padding: 20px 24px;
            }
        }
        .controls-title {
            font-size: 13px;
            font-weight: 600;
            color: rgba(255,255,255,0.9);
            margin-bottom: 16px;
            text-align: center;
            letter-spacing: 0.05em;
        }
        .controls-arrows {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            margin-bottom: 10px;
        }
        .controls-row {
            display: flex;
            gap: 4px;
        }
        .key-hint {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 44px;
            height: 44px;
            background: rgba(255,255,255,0.06);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 10px;
            font-size: 18px;
            font-weight: 500;
            color: rgba(255,255,255,0.7);
            cursor: pointer;
            transition: all 0.15s ease;
        }
        .key-hint:hover {
            background: rgba(52, 211, 153, 0.15);
            border-color: rgba(52, 211, 153, 0.3);
            color: #34d399;
            transform: translateY(-2px);
        }
        .key-hint:active, .key-hint.active {
            background: rgba(52, 211, 153, 0.25);
            border-color: rgba(52, 211, 153, 0.5);
            color: #34d399;
            transform: scale(0.95);
        }
        .key-hint.space-key {
            grid-column: span 3;
            width: 100%;
            height: 40px;
            font-size: 13px;
            letter-spacing: 0.1em;
        }
        .key-label {
            font-size: 10px;
            color: rgba(255,255,255,0.4);
            text-align: center;
            margin-top: 8px;
        }
        .controls-hint {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            color: rgba(255,255,255,0.35);
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid rgba(255,255,255,0.06);
        }
    </style>
</head>
<body class="font-sans antialiased overflow-x-hidden">

    <!-- Dots Navigation -->
    <nav class="dots-nav" id="dots-nav">
        <button data-section="0" data-label="Start" class="active"></button>
        <button data-section="1" data-label="Droga"></button>
        <button data-section="2" data-label="Sklep"></button>
        <button data-section="3" data-label="TakeDrop"></button>
        <button data-section="4" data-label="Inkubator"></button>
        <button data-section="5" data-label="Motto"></button>
        <button data-section="6" data-label="Współpraca"></button>
        <button data-section="7" data-label="Kontakt"></button>
    </nav>

    <!-- Tetris Panel (Fixed on desktop) -->
    <div id="tetris-panel">
        <div id="tetris-canvas"></div>
        <div class="tetris-overlay"></div>

        <!-- Keyboard controls -->
        <div id="keyboard-controls">
            <div class="controls-title">Sterowanie</div>
            <div class="controls-arrows">
                <button data-key="up" class="key-hint" title="Obróć">↑</button>
                <div class="controls-row">
                    <button data-key="left" class="key-hint" title="Lewo">←</button>
                    <button data-key="down" class="key-hint" title="W dół">↓</button>
                    <button data-key="right" class="key-hint" title="Prawo">→</button>
                </div>
            </div>
            <button data-key="space" class="key-hint space-key" title="Upuść">SPACE</button>
            <div class="controls-hint">
                <span>← → Ruch</span>
                <span>↑ Obróć</span>
                <span>Space Upuść</span>
            </div>
        </div>
    </div>

    <!-- Fullpage Container -->
    <div class="fullpage-container" id="fullpage">

        <!-- Section 1: Hero -->
        <section class="fullpage-section track-section flex items-center" data-section="0" style="--accent-glow: rgba(99, 102, 241, 0.15)">
            <!-- Mobile scroll indicator -->
            <div class="scroll-indicator">
                <span>PRZEWIŃ</span>
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 5v14M5 12l7 7 7-7"/>
                </svg>
            </div>

            <div class="content-area px-6">
                <div class="section-content visible">
                    <div class="inline-flex items-center gap-2.5 bg-white/[0.05] border border-white/[0.08] rounded-full px-5 py-2 mb-8 backdrop-blur-sm">
                        <span class="w-2 h-2 bg-emerald-500 rounded-full animate-pulse"></span>
                        <span class="text-[14px] tracking-wide"><span class="text-white font-medium">Tomasz Niedźwiecki</span><span class="badge-subtitle"> <span class="text-zinc-500">·</span> <span class="text-zinc-400">Przedsiębiorca · Inwestor</span></span></span>
                    </div>

                    <h1 class="text-[clamp(36px,5vw,56px)] font-bold gradient-text leading-[1.15] tracking-[-0.02em] mb-6">
                        Inwestuję w ludzi<br>i buduję z nimi <span class="whitespace-nowrap">e-biznesy</span>
                    </h1>

                    <p class="text-[18px] md:text-[20px] text-zinc-400 leading-[1.7] mb-10">
                        Zbudowałem 3 firmy o łącznych przychodach ponad <span class="text-white font-medium">70 mln zł</span>.
                        Po sprzedaży udziałów inwestuję w ambitne osoby. Buduję im biznesy,
                        wdrażam w nie i przekazuję stery zostając wspólnikiem.
                    </p>

                    <a href="/zapisy"
                       class="btn-primary inline-flex items-center justify-center gap-2.5 text-black h-14 px-8 rounded-xl text-[16px] font-medium transition-all duration-200 hover:scale-[1.02]">
                        Zgłoś się
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M5 12h14M12 5l7 7-7 7"/>
                        </svg>
                    </a>
                </div>
            </div>
        </section>

        <!-- Section 2: Track Record Intro -->
        <section class="fullpage-section flex items-center" data-section="1">
            <div class="content-area px-6">
                <div class="section-content">
                    <p class="text-[14px] text-zinc-500 tracking-[0.2em] uppercase mb-6">Moja droga</p>

                    <h2 class="text-[42px] md:text-[56px] font-bold text-white leading-[1.1] tracking-[-0.02em] mb-8">
                        15 lat budowania<br>biznesów online
                    </h2>

                    <p class="text-[18px] md:text-[20px] text-zinc-400 leading-[1.7] mb-12">
                        Od <span class="text-emerald-400">sklepu internetowego</span> w dropshippingu założonego na studiach, przez budowę <span class="text-[#ffb400]">platformy SaaS</span> wycenionej na 25 mln zł i wdrożenie <span class="text-purple-400">tysięcy osób</span> w sprzedaż online po sprzedaż udziałów i nowy etap — inwestycję w ludzi i budowę dla nich e-biznesów.
                    </p>

                    <div class="flex items-center gap-4 text-[14px]">
                        <div class="flex items-center gap-2.5 px-3 py-1.5 rounded-full bg-emerald-500/10 border border-emerald-500/20">
                            <span class="w-2 h-2 rounded-full bg-emerald-500"></span>
                            <span class="text-emerald-400">Sklep</span>
                        </div>
                        <div class="flex items-center gap-2.5 px-3 py-1.5 rounded-full bg-[#ffb400]/10 border border-[#ffb400]/20">
                            <span class="w-2 h-2 rounded-full bg-[#ffb400]"></span>
                            <span class="text-[#ffb400]">TakeDrop</span>
                        </div>
                        <div class="flex items-center gap-2.5 px-3 py-1.5 rounded-full bg-purple-500/10 border border-purple-500/20">
                            <span class="w-2 h-2 rounded-full bg-purple-500"></span>
                            <span class="text-purple-400">Inkubator</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 3: Sklep internetowy -->
        <section class="fullpage-section track-section flex items-center" data-section="2" style="--accent-glow: rgba(16, 185, 129, 0.1)">
            <div class="content-area px-6">
                <div class="section-content">
                    <div class="track-icon bg-gradient-to-br from-emerald-500/20 to-emerald-500/5 border border-emerald-500/20">
                        <i class="ph ph-storefront text-emerald-400 text-5xl"></i>
                    </div>

                    <div class="flex items-center gap-3 mb-5">
                        <span class="text-[13px] text-zinc-500 tracking-wider uppercase">2011 — 2021</span>
                        <span class="w-10 h-px bg-zinc-700"></span>
                    </div>

                    <h2 class="text-[42px] md:text-[56px] font-bold text-white leading-[1.1] tracking-[-0.02em] mb-4">
                        Sklep internetowy
                    </h2>

                    <p class="text-[28px] md:text-[36px] font-medium text-emerald-400 mb-8">
                        Od zera do 40 MLN
                    </p>

                    <p class="text-[17px] md:text-[19px] text-zinc-400 leading-[1.8] mb-10">
                        Zacząłem od dropshippingu na studiach. Po paru latach zbudowałem jeden z największych sklepów e-commerce w swojej niszy. Sprzedaż na poziomie 40 mln zł, zespół 30 osób, ogrom doświadczenia w e-handlu.
                    </p>

                    <div class="flex items-center gap-8 text-[15px] text-zinc-500">
                        <div class="flex items-center gap-2">
                            <i class="ph ph-chart-line-up text-emerald-400 text-lg"></i>
                            <span>40 mln zł przychodu</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <i class="ph ph-users text-emerald-400 text-lg"></i>
                            <span>30 osób w zespole</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 4: TakeDrop -->
        <section class="fullpage-section track-section flex items-center" data-section="3" style="--accent-glow: rgba(255, 180, 0, 0.1)">
            <div class="content-area px-6">
                <div class="section-content">
                    <div class="track-icon bg-gradient-to-br from-[#ffb400]/20 to-[#ffb400]/5 border border-[#ffb400]/20">
                        <i class="ph ph-package text-[#ffb400] text-5xl"></i>
                    </div>

                    <div class="flex items-center gap-3 mb-5">
                        <span class="text-[13px] text-zinc-500 tracking-wider uppercase">2017 — 2025</span>
                        <span class="w-10 h-px bg-zinc-700"></span>
                    </div>

                    <h2 class="text-[42px] md:text-[56px] font-bold text-white leading-[1.1] tracking-[-0.02em] mb-4">
                        TakeDrop
                    </h2>

                    <p class="text-[28px] md:text-[36px] font-medium text-[#ffb400] mb-8">
                        Platforma e-commerce i szkolenia
                    </p>

                    <p class="text-[17px] md:text-[19px] text-zinc-400 leading-[1.8] mb-10">
                        Na bazie swoich doświadczeń, potrzeb i problemów stworzyłem platformę e-commerce. Najpierw dla siebie, potem dla innych, którzy chcieli robić to co ja. Dzisiaj korzysta z niej ponad 5 tysięcy sklepów online. W moich szkoleniach, kursach i mentoringach wzięło udział parę tysięcy osób.
                    </p>

                    <div class="flex items-center gap-8 text-[15px] text-zinc-500">
                        <div class="flex items-center gap-2">
                            <i class="ph ph-code text-[#ffb400] text-lg"></i>
                            <span>Platforma SaaS</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <i class="ph ph-graduation-cap text-[#ffb400] text-lg"></i>
                            <span>Program szkoleniowy</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 5: Inkubator -->
        <section class="fullpage-section track-section flex items-center" data-section="4" style="--accent-glow: rgba(168, 85, 247, 0.1)">
            <div class="content-area px-6">
                <div class="section-content">
                    <div class="track-icon bg-gradient-to-br from-purple-500/20 to-purple-500/5 border border-purple-500/20">
                        <i class="ph ph-graduation-cap text-purple-400 text-5xl"></i>
                    </div>

                    <div class="flex items-center gap-3 mb-5">
                        <span class="text-[13px] text-zinc-500 tracking-wider uppercase">2024 — 2025</span>
                        <span class="w-10 h-px bg-zinc-700"></span>
                    </div>

                    <h2 class="text-[42px] md:text-[56px] font-bold text-white leading-[1.1] tracking-[-0.02em] mb-4">
                        Inkubator
                    </h2>

                    <p class="text-[28px] md:text-[36px] font-medium text-purple-400 mb-8">
                        Tysiące osób z ułatwionym startem
                    </p>

                    <p class="text-[17px] md:text-[19px] text-zinc-400 leading-[1.8] mb-10">
                        Pierwszy w Polsce zbudowałem system łączący prawo, podatki i technologię aby umożliwić osobom bez działalności legalne rozpoczęcie sprzedaży w ramach inkubatora TakeTrust. Bez limitu przychodu, bez ZUS z pełnym bezpieczeństwem.
                    </p>

                    <div class="flex items-center gap-6 text-[15px] text-zinc-500">
                        <div class="flex items-center gap-2">
                            <i class="ph ph-minus text-purple-400 text-lg"></i>
                            <span>Bez ZUS</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <i class="ph ph-minus text-purple-400 text-lg"></i>
                            <span>Bez działalności</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <i class="ph ph-shield-check text-purple-400 text-lg"></i>
                            <span>Pełne bezpieczeństwo</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 6: Motto -->
        <section class="fullpage-section flex items-center" data-section="5">
            <div class="content-area px-6">
                <div class="section-content">
                    <blockquote class="text-[28px] md:text-[36px] lg:text-[42px] font-medium text-white leading-[1.4] tracking-[-0.01em]">
                        <span class="text-zinc-500">"</span>Budując biznes, rozwiązujemy problemy, za które klienci chcą płacić – <span class="text-emerald-400">dużo, często</span> i bez wahania. Pamiętaj: Im mocniej problem boli, tym łatwiej sprzedać na niego rozwiązanie.<span class="text-zinc-500">"</span>
                    </blockquote>
                    <p class="mt-8 text-[18px] text-zinc-500">— Tomasz Niedźwiecki</p>
                </div>
            </div>
        </section>

        <!-- Section 7: Współpraca -->
        <section class="fullpage-section flex items-center" data-section="6">
            <div class="content-area px-6">
                <div class="section-content">
                    <p class="text-[14px] text-zinc-500 tracking-[0.2em] uppercase mb-5">Współpraca</p>
                    <h2 class="text-[36px] md:text-[44px] font-bold text-white tracking-[-0.02em] leading-[1.2] mb-6">
                        Sprawdzony model.<br>
                        <span class="text-zinc-500">Nowa nisza. Twój biznes.</span>
                    </h2>

                    <p class="text-[17px] text-zinc-400 leading-relaxed mb-10">
                        Zbuduję dla Ciebie biznes, wdrożę Cię w&nbsp;jego prowadzenie i&nbsp;przekażę stery — zostając Twoim wspólnikiem.
                    </p>

                    <div class="offer-cards">
                        <div class="offer-card offer-card--emerald">
                            <div class="offer-card__icon">
                                <i class="ph-duotone ph-storefront"></i>
                            </div>
                            <div class="offer-card__content">
                                <h3>Nowoczesny sklep e-commerce</h3>
                                <p>Nie buduję sklepów — tworzę przyciągające marki</p>
                            </div>
                        </div>

                        <div class="offer-card offer-card--amber">
                            <div class="offer-card__icon">
                                <i class="ph-duotone ph-code"></i>
                            </div>
                            <div class="offer-card__content">
                                <h3>Aplikacje / Narzędzia / SaaS</h3>
                                <p>Wdrażam rozwiązania, które stają się niezbędne</p>
                            </div>
                        </div>

                        <div class="offer-card offer-card--purple">
                            <div class="offer-card__icon">
                                <i class="ph-duotone ph-video-camera"></i>
                            </div>
                            <div class="offer-card__content">
                                <h3>Kursy online</h3>
                                <p>Pokazuję jak sprzedawać wiedzę aby zarabiać i dawać realną wartość</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 8: CTA + Footer -->
        <section class="fullpage-section track-section flex items-center" data-section="7" style="--accent-glow: rgba(52, 211, 153, 0.12)">
            <div class="content-area px-6">
                <div class="section-content">
                    <h2 class="text-[42px] md:text-[56px] font-bold text-white tracking-[-0.02em] mb-10">
                        Chcesz zrobić biznes?
                    </h2>

                    <a href="/zapisy"
                       class="btn-primary inline-flex items-center justify-center gap-2.5 text-black h-14 px-10 rounded-xl text-[17px] font-medium transition-all duration-200 hover:scale-[1.02] mb-20">
                        Wypełnij kwestionariusz
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M5 12h14M12 5l7 7-7 7"/>
                        </svg>
                    </a>

                    <!-- Footer -->
                    <div class="border-t border-white/[0.06] pt-10">
                        <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 text-[14px] text-zinc-600">
                            <span>© 2025 Tomasz Niedźwiecki · NIP 6972240255</span>
                            <div class="flex items-center gap-8">
                                <a href="/regulamin" class="hover:text-zinc-400 transition-colors">Regulamin</a>
                                <a href="/polityka-prywatnosci" class="hover:text-zinc-400 transition-colors">Prywatność</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </div>

    <!-- Fullpage Scroll JavaScript -->
    <script>
        (function() {
            const container = document.getElementById('fullpage');
            const sections = container.querySelectorAll('.fullpage-section');
            const dots = document.querySelectorAll('#dots-nav button');
            let currentSection = 0;
            let isScrolling = false;
            let scrollTimeout;

            // Check if desktop
            const isDesktop = () => window.innerWidth >= 768;

            // Update active dot
            const updateDots = (index) => {
                dots.forEach((dot, i) => {
                    dot.classList.toggle('active', i === index);
                });
            };

            // Scroll to section
            const scrollToSection = (index) => {
                if (!isDesktop() || index < 0 || index >= sections.length) return;

                isScrolling = true;
                container.classList.add('is-scrolling');
                currentSection = index;
                updateDots(index);

                sections[index].scrollIntoView({ behavior: 'smooth' });

                clearTimeout(scrollTimeout);
                scrollTimeout = setTimeout(() => {
                    isScrolling = false;
                    container.classList.remove('is-scrolling');
                }, 1000);
            };

            // Intersection Observer for section visibility
            const createObserver = () => {
                return new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const index = parseInt(entry.target.dataset.section);
                            currentSection = index;
                            updateDots(index);

                            // Animate content (desktop only - mobile is always visible via CSS)
                            const content = entry.target.querySelector('.section-content');
                            if (content) content.classList.add('visible');
                        }
                    });
                }, {
                    root: container,
                    threshold: 0.5
                });
            };

            let observer = createObserver();
            sections.forEach(section => observer.observe(section));

            // Recreate observer on resize
            window.addEventListener('resize', () => {
                observer.disconnect();
                observer = createObserver();
                sections.forEach(section => observer.observe(section));
            });

            // Dot clicks
            dots.forEach(dot => {
                dot.addEventListener('click', () => {
                    const index = parseInt(dot.dataset.section);
                    scrollToSection(index);
                });
            });

            // Wheel event for controlled scrolling
            container.addEventListener('wheel', (e) => {
                if (!isDesktop() || isScrolling) {
                    if (isScrolling) e.preventDefault();
                    return;
                }

                const delta = e.deltaY;
                if (Math.abs(delta) < 30) return;

                e.preventDefault();

                if (delta > 0 && currentSection < sections.length - 1) {
                    scrollToSection(currentSection + 1);
                } else if (delta < 0 && currentSection > 0) {
                    scrollToSection(currentSection - 1);
                }
            }, { passive: false });

            // Keyboard navigation (Page Up/Down only - arrows reserved for Tetris)
            document.addEventListener('keydown', (e) => {
                if (!isDesktop()) return;

                if (e.code === 'PageDown') {
                    e.preventDefault();
                    scrollToSection(currentSection + 1);
                } else if (e.code === 'PageUp') {
                    e.preventDefault();
                    scrollToSection(currentSection - 1);
                }
            });

            // Touch support
            let touchStartY = 0;
            container.addEventListener('touchstart', (e) => {
                touchStartY = e.touches[0].clientY;
            }, { passive: true });

            container.addEventListener('touchend', (e) => {
                if (!isDesktop() || isScrolling) return;

                const touchEndY = e.changedTouches[0].clientY;
                const diff = touchStartY - touchEndY;

                if (Math.abs(diff) > 50) {
                    if (diff > 0) scrollToSection(currentSection + 1);
                    else scrollToSection(currentSection - 1);
                }
            }, { passive: true });
        })();
    </script>

    <!-- 3D Tetris Game -->
    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { RoundedBoxGeometry } from 'three/addons/geometries/RoundedBoxGeometry.js';
        import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
        import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';
        import { UnrealBloomPass } from 'three/addons/postprocessing/UnrealBloomPass.js';

        // ==================== CONSTANTS ====================
        const BOARD_W = 10, BOARD_H = 20;
        const BLOCK = 0.52, GAP = 0.06, UNIT = BLOCK + GAP;

        const COLORS = {
            I: 0x34d399, O: 0xffb400, T: 0xa855f7,
            S: 0x10b981, Z: 0xc084fc, J: 0x6366f1, L: 0xfbbf24
        };

        const PIECES = {
            I: { shape: [[0,0],[1,0],[2,0],[3,0]], color: COLORS.I },
            O: { shape: [[0,0],[1,0],[0,1],[1,1]], color: COLORS.O },
            T: { shape: [[0,0],[1,0],[2,0],[1,1]], color: COLORS.T },
            S: { shape: [[1,0],[2,0],[0,1],[1,1]], color: COLORS.S },
            Z: { shape: [[0,0],[1,0],[1,1],[2,1]], color: COLORS.Z },
            J: { shape: [[0,0],[0,1],[1,1],[2,1]], color: COLORS.J },
            L: { shape: [[2,0],[0,1],[1,1],[2,1]], color: COLORS.L }
        };
        const TYPES = Object.keys(PIECES);

        // ==================== GAME STATE ====================
        let game = {
            board: [], current: null, type: null, rot: 0, x: 0, y: 0, next: null,
            playing: true, drop: 0, interval: 1800,
            userActive: false, aiTarget: null
        };

        // ==================== THREE.JS ====================
        const container = document.getElementById('tetris-canvas');

        // Only initialize on desktop
        const isMobileDevice = window.innerWidth < 768;

        if (!isMobileDevice) {
            // Wait for container to be visible
            function waitForContainer(callback) {
                if (container && container.offsetWidth > 0) {
                    callback();
                } else {
                    requestAnimationFrame(() => waitForContainer(callback));
                }
            }
            waitForContainer(initTetris);
        }

        function initTetris() {
        const scene = new THREE.Scene();
        // Board dimensions: 10 wide x 20 tall, UNIT = 0.58
        // Board size: ~5.8 wide, ~11.6 tall
        const boardCenterX = BOARD_W * UNIT / 2;
        const boardCenterY = BOARD_H * UNIT / 2;

        // Camera positioned to center Tetris in visible area (right of gradient overlay)
        // Offset X by +1.5 to compensate for left-side gradient
        const camera = new THREE.PerspectiveCamera(50, container.clientWidth / container.clientHeight, 0.1, 1000);
        camera.position.set(boardCenterX + 1.5, boardCenterY - 0.5, 14);

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(container.clientWidth, container.clientHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        renderer.toneMapping = THREE.ACESFilmicToneMapping;
        renderer.toneMappingExposure = 1.4;
        container.appendChild(renderer.domElement);

        const composer = new EffectComposer(renderer);
        composer.addPass(new RenderPass(scene, camera));
        const bloom = new UnrealBloomPass(new THREE.Vector2(container.clientWidth, container.clientHeight), 0.75, 0.5, 0.8);
        composer.addPass(bloom);

        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.03;
        controls.enableZoom = false;
        controls.enablePan = false;
        controls.autoRotate = true;
        controls.autoRotateSpeed = 0.3;
        controls.minPolarAngle = Math.PI * 0.42;
        controls.maxPolarAngle = Math.PI * 0.48;
        controls.minAzimuthAngle = -Math.PI * 0.08;
        controls.maxAzimuthAngle = Math.PI * 0.08;
        // Center on board (offset to match camera)
        controls.target.set(boardCenterX + 1.5, boardCenterY - 0.5, 0);

        // Environment - warm gradient with emerald/gold hints
        const pmrem = new THREE.PMREMGenerator(renderer);
        const envScene = new THREE.Scene();
        envScene.add(new THREE.Mesh(
            new THREE.SphereGeometry(50, 32, 32),
            new THREE.ShaderMaterial({
                side: THREE.BackSide,
                vertexShader: `varying vec3 vP; void main() { vP = (modelMatrix * vec4(position,1.0)).xyz; gl_Position = projectionMatrix * modelViewMatrix * vec4(position,1.0); }`,
                fragmentShader: `varying vec3 vP; void main() { float h = normalize(vP).y; vec3 bottom = vec3(0.02, 0.04, 0.03); vec3 top = vec3(0.06, 0.08, 0.1); gl_FragColor = vec4(mix(bottom, top, h*0.5+0.5), 1.0); }`
            })
        ));
        scene.environment = pmrem.fromScene(envScene).texture;

        // Lighting - colors matching page palette
        scene.add(new THREE.AmbientLight(0xffffff, 0.5));
        const mainL = new THREE.DirectionalLight(0xffffff, 2.2);
        mainL.position.set(8, 20, 12);
        scene.add(mainL);
        // Emerald fill light from left
        const fillL = new THREE.DirectionalLight(0x34d399, 1.2);
        fillL.position.set(-12, 10, -6);
        scene.add(fillL);
        // Gold accent from right
        const goldL = new THREE.DirectionalLight(0xffb400, 0.8);
        goldL.position.set(15, 5, 8);
        scene.add(goldL);
        // Purple back light
        const backL = new THREE.DirectionalLight(0xa855f7, 0.7);
        backL.position.set(0, -5, -10);
        scene.add(backL);

        // ==================== RENDERING ====================
        const blockGeo = new RoundedBoxGeometry(BLOCK, BLOCK, BLOCK, 5, 0.06);
        const matCache = {};

        const getMat = (c, o=1) => {
            const k = `${c}-${o}`;
            if (!matCache[k]) {
                matCache[k] = new THREE.MeshPhysicalMaterial({
                    color: c, metalness: 0.12, roughness: 0.15,
                    envMapIntensity: 2.2, clearcoat: 0.9, clearcoatRoughness: 0.1,
                    transparent: o < 1, opacity: o,
                    emissive: c, emissiveIntensity: o < 1 ? 0 : 0.12
                });
            }
            return matCache[k];
        };

        const createBlock = (x, y, c, o=1) => {
            const m = new THREE.Mesh(blockGeo, getMat(c, o));
            m.position.set(x * UNIT, y * UNIT, 0);
            if (o === 1) {
                const e = new THREE.LineSegments(
                    new THREE.EdgesGeometry(blockGeo, 20),
                    new THREE.LineBasicMaterial({ color: 0x6ee7b7, transparent: true, opacity: 0.2 })
                );
                e.position.copy(m.position);
                const g = new THREE.Group();
                g.add(m); g.add(e);
                return g;
            }
            return m;
        };

        const boardGroup = new THREE.Group();
        scene.add(boardGroup);

        // Frame - subtle emerald tint
        const frameMat = new THREE.MeshPhysicalMaterial({
            color: 0x1a3a3a, metalness: 0.85, roughness: 0.25,
            transparent: true, opacity: 0.4, envMapIntensity: 1.2
        });
        const frameH = BOARD_H * UNIT * 0.6;
        const bottom = new THREE.Mesh(new RoundedBoxGeometry(BOARD_W * UNIT + 0.4, 0.12, 0.6, 4, 0.03), frameMat);
        bottom.position.set(BOARD_W * UNIT / 2 - UNIT/2, -0.15, 0);
        boardGroup.add(bottom);
        const left = new THREE.Mesh(new RoundedBoxGeometry(0.12, frameH, 0.6, 4, 0.03), frameMat);
        left.position.set(-0.2 - UNIT/2, frameH/2 - UNIT/2, 0);
        boardGroup.add(left);
        const right = new THREE.Mesh(new RoundedBoxGeometry(0.12, frameH, 0.6, 4, 0.03), frameMat);
        right.position.set(BOARD_W * UNIT - UNIT/2 + 0.2, frameH/2 - UNIT/2, 0);
        boardGroup.add(right);

        let boardBlocks = [], pieceBlocks = [], ghostBlocks = [];
        const clearArr = arr => { arr.forEach(b => boardGroup.remove(b)); arr.length = 0; };

        const renderBoard = () => {
            clearArr(boardBlocks);
            for (let y = 0; y < BOARD_H; y++)
                for (let x = 0; x < BOARD_W; x++)
                    if (game.board[y]?.[x]) {
                        const b = createBlock(x, y, game.board[y][x]);
                        boardBlocks.push(b);
                        boardGroup.add(b);
                    }
        };

        const getRotated = () => {
            const base = PIECES[game.type].shape;
            let s = base.map(([x,y]) => [x,y]);
            for (let r = 0; r < game.rot % 4; r++)
                s = s.map(([x,y]) => [-y + 1, x]);
            return s;
        };

        const renderPiece = () => {
            clearArr(pieceBlocks);
            clearArr(ghostBlocks);
            if (!game.current) return;
            const c = PIECES[game.type].color;
            const shape = getRotated();
            let gy = game.y;
            while (valid(game.x, gy - 1, shape)) gy--;
            shape.forEach(([bx, by]) => {
                const g = createBlock(game.x + bx, gy + by, c, 0.15);
                ghostBlocks.push(g);
                boardGroup.add(g);
            });
            shape.forEach(([bx, by]) => {
                const b = createBlock(game.x + bx, game.y + by, c);
                pieceBlocks.push(b);
                boardGroup.add(b);
            });
        };

        // ==================== GAME LOGIC ====================
        const initBoard = () => { game.board = []; for (let y = 0; y < BOARD_H; y++) game.board[y] = new Array(BOARD_W).fill(null); };

        const valid = (nx, ny, shape) => {
            for (const [bx, by] of shape) {
                const x = nx + bx, y = ny + by;
                if (x < 0 || x >= BOARD_W || y < 0) return false;
                if (y < BOARD_H && game.board[y][x]) return false;
            }
            return true;
        };

        const spawn = () => {
            game.type = game.next || TYPES[Math.floor(Math.random() * TYPES.length)];
            game.next = TYPES[Math.floor(Math.random() * TYPES.length)];
            game.rot = 0;
            game.x = Math.floor(BOARD_W / 2) - 1;
            game.y = 14;
            game.current = PIECES[game.type];
            game.aiTarget = null;
            if (!valid(game.x, game.y, getRotated())) {
                setTimeout(() => { game.userActive = false; restartGame(); }, 1000);
            }
        };

        const move = (dx, dy) => {
            if (!game.playing) return false;
            const shape = getRotated();
            if (valid(game.x + dx, game.y + dy, shape)) {
                game.x += dx; game.y += dy;
                renderPiece();
                return true;
            }
            return false;
        };

        const rotate = () => {
            if (!game.playing) return;
            const oldRot = game.rot;
            game.rot = (game.rot + 1) % 4;
            const shape = getRotated();
            const kicks = [0, -1, 1, -2, 2];
            for (const k of kicks) {
                if (valid(game.x + k, game.y, shape)) {
                    game.x += k;
                    renderPiece();
                    return;
                }
            }
            game.rot = oldRot;
        };

        const hardDrop = () => {
            if (!game.playing) return;
            while (move(0, -1)) {}
            lock();
        };

        const lock = () => {
            const shape = getRotated();
            const c = PIECES[game.type].color;
            shape.forEach(([bx, by]) => {
                const x = game.x + bx, y = game.y + by;
                if (y >= 0 && y < BOARD_H) game.board[y][x] = c;
            });
            for (let y = BOARD_H - 1; y >= 0; y--) {
                if (game.board[y].every(c => c !== null)) {
                    game.board.splice(y, 1);
                    game.board.push(new Array(BOARD_W).fill(null));
                    y++;
                }
            }
            renderBoard();
            spawn();
            renderPiece();
        };

        // ==================== AI ====================
        const evaluatePosition = (board, shape, x, y) => {
            const testBoard = board.map(row => [...row]);
            shape.forEach(([bx, by]) => {
                const px = x + bx, py = y + by;
                if (py >= 0 && py < BOARD_H && px >= 0 && px < BOARD_W) testBoard[py][px] = 1;
            });
            let score = 0;
            let heights = [];
            for (let col = 0; col < BOARD_W; col++) {
                let h = 0;
                for (let row = BOARD_H - 1; row >= 0; row--) {
                    if (testBoard[row][col]) { h = row + 1; break; }
                }
                heights.push(h);
            }
            score -= heights.reduce((a, b) => a + b, 0) * 0.5;
            let lines = 0;
            for (let row = 0; row < BOARD_H; row++) {
                if (testBoard[row].every(c => c !== null)) lines++;
            }
            score += lines * 10;
            let holes = 0;
            for (let col = 0; col < BOARD_W; col++) {
                let blockFound = false;
                for (let row = BOARD_H - 1; row >= 0; row--) {
                    if (testBoard[row][col]) blockFound = true;
                    else if (blockFound) holes++;
                }
            }
            score -= holes * 3;
            let bumpiness = 0;
            for (let i = 0; i < heights.length - 1; i++) {
                bumpiness += Math.abs(heights[i] - heights[i + 1]);
            }
            score -= bumpiness * 0.5;
            return score;
        };

        const findBestMove = () => {
            let best = { score: -Infinity, x: game.x, rot: 0 };
            for (let rot = 0; rot < 4; rot++) {
                let shape = PIECES[game.type].shape.map(([x, y]) => [x, y]);
                for (let r = 0; r < rot; r++) shape = shape.map(([x, y]) => [-y + 1, x]);
                for (let x = -2; x < BOARD_W + 2; x++) {
                    if (!valid(x, game.y, shape)) continue;
                    let y = game.y;
                    while (valid(x, y - 1, shape)) y--;
                    if (!valid(x, y, shape)) continue;
                    const score = evaluatePosition(game.board, shape, x, y);
                    if (score > best.score) best = { score, x, rot };
                }
            }
            return best;
        };

        const aiStep = () => {
            if (!game.playing || game.userActive) return;
            if (!game.aiTarget) game.aiTarget = findBestMove();
            if (game.rot !== game.aiTarget.rot) { rotate(); return; }
            if (game.x < game.aiTarget.x) { move(1, 0); return; }
            if (game.x > game.aiTarget.x) { move(-1, 0); return; }
            hardDrop();
        };

        function restartGame() {
            game = {
                board: [], current: null, type: null, rot: 0, x: 0, y: 0, next: null,
                playing: true, drop: performance.now(), interval: 1800,
                userActive: false, aiTarget: null
            };
            initBoard();
            clearArr(boardBlocks);
            spawn();
            renderBoard();
            renderPiece();
        }

        // ==================== INPUT ====================
        const handleKey = (key) => {
            if (!game.playing) return;
            game.userActive = true;
            switch (key) {
                case 'left': move(-1, 0); break;
                case 'right': move(1, 0); break;
                case 'down': move(0, -1); break;
                case 'up': rotate(); break;
                case 'space': hardDrop(); break;
            }
        };

        document.addEventListener('keydown', e => {
            const keyMap = {
                'ArrowLeft': 'left', 'ArrowRight': 'right',
                'ArrowDown': 'down', 'ArrowUp': 'up', 'Space': 'space'
            };
            if (keyMap[e.code]) {
                e.preventDefault();
                handleKey(keyMap[e.code]);
                const btn = document.querySelector(`[data-key="${keyMap[e.code]}"]`);
                if (btn) {
                    btn.classList.add('active');
                    setTimeout(() => btn.classList.remove('active'), 100);
                }
            }
        });

        document.querySelectorAll('#keyboard-controls button').forEach(btn => {
            btn.addEventListener('click', () => handleKey(btn.dataset.key));
        });

        // ==================== LOOP ====================
        let lastAiTime = 0;

        function animate(t) {
            requestAnimationFrame(animate);
            controls.update();
            if (game.playing) {
                if (t - game.drop >= game.interval) {
                    if (!move(0, -1)) lock();
                    game.drop = t;
                }
                if (!game.userActive && t - lastAiTime > 500) {
                    aiStep();
                    lastAiTime = t;
                }
            }
            composer.render();
        }

        window.addEventListener('resize', () => {
            const w = container.clientWidth, h = container.clientHeight;
            camera.aspect = w / h;
            camera.updateProjectionMatrix();
            renderer.setSize(w, h);
            composer.setSize(w, h);
        });

        initBoard();
        spawn();
        renderBoard();
        renderPiece();
        game.drop = performance.now();
        animate(0);
        } // end initTetris
    </script>

</body>
</html>
